<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- ./index.qdoc -->
<head>
  <title>Qt Context Framework Developer Resources</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qtlogo.png" align="left" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a></td>
<td align="right" valign="top" width="230"><img src="images/codeless.png"  border="0" /></td></tr></table><h1 class="title">Qt Context Framework Developer Resources<br /><span class="subtitle"></span>
</h1>
<p>The Qt Context Framework allows developers to construct context sensitive trees of data by means of the Qt Value Space. This allows a variety of different context dependent uses, for example, the data may be strings for a context sensitive help system, or perhaps a context sensitive remap of buttons.</p>
<ul><li><a href="#qt-value-space">Qt Value Space</a></li>
<ul><li><a href="#architecture">Architecture</a></li>
<ul><li><a href="#shared-memory-layer">Shared Memory Layer</a></li>
</ul>
</ul>
<li><a href="#building-and-compiling">Building and compiling</a></li>
<li><a href="#example-publish-and-subscribe">Example: Publish and Subscribe</a></li>
<li><a href="#example-battery-charging-accessing-publish-and-subscribe-from-qml">Example: Battery Charging - Accessing Publish and Subscribe from QML</a></li>
</ul>
<a name="qt-value-space"></a>
<h3>Qt Value Space</h3>
<p>The Qt Value Space unifies various sources of hierarchical data into a single consistent model. Conceptually the Value Space is a hierarchical tree of which each node or leaf can optionally contain a <a href="http://qt.nokia.com/doc/4.5/porting4.html">QVariant</a> value. A serialized version of a simple example Value Space might look like this.</p>
<pre>    /Device/Buttons = 3
    /Device/Buttons/1/Name = Context
    /Device/Buttons/1/Usable = true
    /Device/Buttons/2/Name = Select
    /Device/Buttons/2/Usable = false
    /Device/Buttons/3/Name = Back
    /Device/Buttons/3/Usable = true</pre>
<p>Programmers access the Value Space through the <a href="qvaluespaceitem.html">QValueSpaceItem</a> class. This class allows applications to read item values, navigate through and subscribe to change notifications for items within the space.</p>
<p>Nodes in the Value Space can be thought of as representing schema objects. Obviously this is a conceptual differentiation and not a physical one, as internally the Value Space is treated as one large tree. By applying structured schema to the space &quot;explorability&quot; is increased. For example, the <tt>/Device/Buttons</tt> schema can be defined as containing a value representing the number of mappable buttons on a device, and a sub-item for each adhering to the <tt>MappableButton</tt> schema. The <tt>MappableButton</tt> schema itself may be defined as containing two attributes <tt>Name</tt> and <tt>Usable</tt>. Change notification is modeled in this fashion also. Where the <tt>/Device/Buttons/1/Name</tt> item is to change, the <tt>/Device/Buttons/1</tt> item would be marked as changed, and so on up the tree. This allows, for example, subscription to just <tt>/Device/Buttons</tt> to be notified when anything &quot;button&quot; related changes.</p>
<p>Internally, the Value Space consists of an arbitrary number of data source trees, or layers, which are stacked on top of each other to form the final unified view. If a &quot;higher&quot; layer contains an item, it shadows the value of items in the layers below it.</p>
<p>The Qt Value Space contains the following layers:</p>
<p><i>Shared Memory Layer</i> The Shared Memory layer allows applications to add and remove &quot;transient&quot; data from the Value Space using shared memory as a backing store. <i>Registry Layer</i> The Registry layer allows applications to add and remove &quot;transient&quot; data from the Value Space using the Windows registry as a backing store.</p>
<p>Access to the available layers is through the <a href="qvaluespaceobject.html">QValueSpaceObject</a> class.</p>
<p>Consider the Value Space item <tt>/Device/Buttons</tt>. If two layer contained this item, the value in the layer with the higher layer order (see <a href="qabstractvaluespacelayer.html#order">QAbstractValueSpaceLayer::order</a>()) would shadow that with the lower layer order. However, if only the layer with the lower order contained this item, it would be visible through the <a href="qvaluespaceitem.html">QValueSpaceItem</a> class, even if the higher order layer contained sub-items such as <tt>/Device/Buttons/1</tt>. That is, layer shadowing occurs by value not by path.</p>
<a name="architecture"></a>
<h4>Architecture</h4>
<p>Layers in the Qt Value Space are provided by objects implementing the <a href="qabstractvaluespacelayer.html">QAbstractValueSpaceLayer</a> interface. The two internal layers, the Shared Memory layer and the Registry layer, are implemented in this fashion. The Value Space supports adding new, 3rd party layers through calls to the <a href="qvaluespace.html#installLayer">QValueSpace::installLayer</a>() method. All layers must be installed prior to the first Value Space usage. Although it is legal to have a different set of layers installed in each process (a process local layer, for example) this asymmetric model is discouraged as it might cause confusion if these two processes communicate.</p>
<p>The Qt Value Space system is divided into two parts: a single server and zero or more clients. Internally the Value Space system draws no distinction between the two - the server is also a client, for example - but certain layers, in particular the Shared Memory layer, do. The Value Space server <b>must</b> be initialized via a call to QValueSpace::initValuespaceManager() prior to any use of the Value Space. Value Space clients will automatically initialize the first time Value Space functionality is used.</p>
<a name="shared-memory-layer"></a>
<h5>Shared Memory Layer</h5>
<p>The external use of the Shared Memory layer is described in <a href="qvaluespaceobject.html">QValueSpaceObject</a>. The Shared Memory layer stores all values in a 10MB block of shared memory which is reserved when the Value Space initializes. As the layer creates this region at startup, it is assumed that the operating system lazily commits memory. If this assumption is invalid, the Shared Memory layer will unnecessarily consume 10MB of memory.</p>
<p>Value Space clients read from the Shared Memory layer's shared memory region directly. A kernel lock is acquired for each read to prevent corruption. While the layer supports concurrent readers, it is possible that a faulty or malicious application could acquire and refuse to release this lock causing any layer updates to be delayed indefinitely.</p>
<p>Only the Value Space server ever writes to the shared memory region. When clients attempt to add items to the layer, their changes are transmitted via a QLocalSocket (e.g&#x2e; <tt>/tmp/qt-N/valuespace_shmlayer</tt> domain socket on Unix systems) to the server where the update is performed. Updates are batched in-process and sent when the process re-enters the Qt event loop. Transmission and synchronization of changes can be forced manually by the <a href="qvaluespaceobject.html#sync">QValueSpaceObject::sync</a>() call, although as this requires a round trip between the client and server, doing so frequently may significantly degrade performance.</p>
<p>Change notifications are transmitted to clients in the form of &quot;something has changed&quot; messages. Nodes within the shared memory region are versioned, which allows clients to quickly determine exactly what has changed without the need for a bulkier change notification protocol.</p>
<a name="building-and-compiling"></a>
<h3>Building and compiling</h3>
<p>This library requires Qt 4.5 to be installed.</p>
<p>To build the library, run <tt>qmake</tt> and <tt>make</tt>.</p>
<a name="example-publish-and-subscribe"></a>
<h3>Example: Publish and Subscribe</h3>
<p>In the example <a href="publish-subscribe.html">Publish and Subscribe</a> the Qt Value Space is used as a method of communicating changes in one dialog (the provider) to another dialog (the consumer).</p>
<a name="example-battery-charging-accessing-publish-and-subscribe-from-qml"></a>
<h3>Example: Battery Charging - Accessing Publish and Subscribe from QML</h3>
<p>In the example <a href="battery-charge.html">Accessing Publish and Subscribe from QML</a> the <a href="publish-subscribe.html">Publish and Subscribe</a> concept is now extended to make the provider an input of the level of charge in a battery. A slider on the provider dialog represents the modifiable level of charge. The Qt Value Space acts as a communications medium between the provider dialog and the consumer graphical battery animation. The battery is implemented in QML and C++ with Qt Value Space supplying the charge level for the animation to represent.</p>
<p>See also <a href="qvaluespaceitem.html">QValueSpaceItem</a>, <a href="qvaluespaceobject.html">QValueSpaceObject</a>, <a href="qvaluespace.html">QValueSpace</a>, and <a href="qabstractvaluespacelayer.html">QAbstractValueSpaceLayer</a>.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
<td align="right"><div align="right">Qt Context Framework</div></td>
</tr></table></div></address></body>
</html>
