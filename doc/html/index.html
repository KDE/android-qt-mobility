<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- ./index.qdoc -->
<head>
  <title>Qt Service Framework Developer Resources</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qtlogo.png" align="left" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a></td>
<td align="right" valign="top" width="230"><img src="images/codeless.png"  border="0" /></td></tr></table><h1 class="title">Qt Service Framework Developer Resources<br /><span class="subtitle"></span>
</h1>
<ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#using-the-framework">Using the framework</a></li>
<ul><li><a href="#verbose-lookup">Verbose lookup</a></li>
<li><a href="#default-lookup">Default lookup</a></li>
<li><a href="#header-lookup">Header lookup</a></li>
</ul>
<li><a href="#adding-and-removing-of-services">Adding and removing of services</a></li>
<ul><li><a href="#xml-format">XML format</a></li>
<li><a href="#installing-the-service-at-runtime">Installing the service at runtime</a></li>
</ul>
<li><a href="#identifying-services">Identifying services</a></li>
<li><a href="#building-and-compiling">Building and compiling</a></li>
<li><a href="#reference-documentation">Reference documentation</a></li>
<ul><li><a href="#main-classes">Main classes</a></li>
<li><a href="#examples">Examples</a></li>
</ul>
</ul>
<a name="introduction"></a>
<h2>Introduction</h2>
<p>The Qt Service framework provides a set of APIs that allows clients to discover and instanciate arbitrary services. This is achieved by defining a unified way of finding, implementing and accessing services across multiple platforms. Due to the service frameworks knowledge of service interfaces, their versions and QObject-based introspection it may even be used to unify and access multiple platform specific service implementations via the same Qt-based client application.</p>
<a name="overview"></a>
<h2>Overview</h2>
<p>A service is an independent component that allows a client to perform a well-defined operation. Clients can find services based on their name and version as well as the interface that is implemented by the service object. Once the service has been identified the framework starts the service and returns a pointer to it. <a href="qservicemanager.html">QServiceManager</a> is the main interface through which clients can access the mentioned framework functionality. In addition services themselves may also act as clients to the service framework by requesting other services installed on the system.</p>
<p>Service provider are implemented via plug-ins. <a href="qserviceplugininterface.html">QServicePluginInterface</a> defines the main interface for each plug-in. In order to avoid that clients have to link against service specific libraries each service object must be derived from QObject. Therefore the QMetaObject system can be used to dynamically discover and invoke the service's capabilities. To achieve the best level of access via the Qt meta object system services should be implemented in such a way that their entire functionality is accessable via the signals, slots, properties or invokable functions (see Q_INVOKABLE macro for more details).</p>
<p>Each service plug-in implements one service only but can provide multiple implementations for multiple interfaces. Therefore a service (plug-in) can retain a certain level of backwards compatibility even if the main service interface breaks in such a way that a new interface name has to be used. Existing clients can still use the previous version of service interface whereas new clients can utilize the new interface.</p>
<p>Future versions of this framework may also enable access to out-of-process service provider.</p>
<a name="using-the-framework"></a>
<h2>Using the framework</h2>
<p>This section assumes that the user wants to access the <i>FileManager</i> service which offers an implementation for the <i>com.nokia.qt.examples.FileStorage</i> interface The service framework enables multiple ways of accessing those implementations.</p>
<p><a href="qservicemanager.html">QServiceManager</a> is the main class to lookup and instanciate services. Services can be found by constraining the search via service meta data or by using the default lookup mechanism.</p>
<a name="verbose-lookup"></a>
<h3>Verbose lookup</h3>
<p>The client code has precise knowledge of the service and its interfaces.</p>
<pre>    QServiceManager* manager = new QServiceManager(this);
    QServiceFilter filter(&quot;com.nokia.qt.examples.FileStorage&quot;);
    filter.setServiceName(&quot;FileManager&quot;);
    QList&lt;QServiceInterfaceDescriptor&gt; objs = manager-&gt;findInterfaces(filter);
    Q_ASSERT(objs.count());

<span class="comment">    //instanciate the FileStorage object</span>
    QObject* service = manager-&gt;loadInterface(objs.at(0));</pre>
<a name="default-lookup"></a>
<h3>Default lookup</h3>
<p>The client code has knowledge of the interface and doesn't really care about the service that implements the interface. In such cases the default service lookup can be utilized to create a service object instance. If the same service provides multiple versions of the same interface the latest version is returned. Therefore subsequent versions of the same interface must always be binary compatible to previous versions.</p>
<pre>    QServiceManager* manager = ...
    QObject* storage = manager-&gt;loadInterface(&quot;com.nokia.qt.examples.FileStorage&quot;);</pre>
<a name="header-lookup"></a>
<h3>Header lookup</h3>
<p>So far all lookup mechanism returned a QObject pointer. This pointer can be utilised by introspecting the object using Qt's meta object system. This implies that the client does not have any knowledge of the object header. In some use cases it may be more convenient to directly interact with the service object by including the service header.</p>
<pre>    #include &lt;filestorage.h&gt;
    ...
    QServiceManager manager;
    FileStorage* storage = 0;
    manager-&gt;setDefaultServiceForInterface(&quot;FileManager&quot;, &quot;com.nokia.qt.examples.FileStorage&quot;);
    storage = manager-&gt;getInterface(&quot;com.nokia.qt.examples.FileStorage&quot;);</pre>
<a name="adding-and-removing-of-services"></a>
<h2>Adding and removing of services</h2>
<p>New services can be installed and removed at runtime. An XML file is used to describe the service meta data and links the service code to its meta description.</p>
<a name="xml-format"></a>
<h3>XML format</h3>
<p>Services are installed via an XML file which describes the meta data and location of the service. The xml file can be described via the following DTD:</p>
<pre>        &lt;!ELEMENT description ( #PCDATA ) &gt;

        &lt;!ELEMENT interface ( description ) &gt;
        &lt;!ATTLIST interface capabilities CDATA #IMPLIED &gt;
        &lt;!ATTLIST interface name NMTOKEN #REQUIRED &gt;
        &lt;!ATTLIST interface version NMTOKEN #REQUIRED &gt;

        &lt;!ELEMENT service ( description, interface+ ) &gt;
        &lt;!ATTLIST service filepath CDATA #REQUIRED &gt;
        &lt;!ATTLIST service name NMTOKEN #REQUIRED &gt;</pre>
<p>The elements and attributes have the following meanings:</p>
<p><table align="center" cellpadding="2" cellspacing="1" border="0">
<thead><tr valign="top" class="qt-style"><th>Element</th><th>Attribute</th><th>Description</th></tr></thead>
<tr valign="top" class="odd"><td>description</td><td></td><td>A user readable description of the purpose of the interface or service.</td></tr>
<tr valign="top" class="even"><td>interface</td><td></td><td>This tag describes the properties of the interface.</td></tr>
<tr valign="top" class="odd"><td>&quot;</td><td>capabilities</td><td>This attribute is a list of arbitrary strings which are interpreted as permissions/capabilities. This list can be empty.</td></tr>
<tr valign="top" class="even"><td>&quot;</td><td>name</td><td>The name of the interface using the Java class name notation. (e.g&#x2e; com.nokia.qt.TestService)</td></tr>
<tr valign="top" class="odd"><td>&quot;</td><td>version</td><td>This attribute contains the interface and implementation version. The version tag follows the <i>major.minor</i> notation. The major version indicates the interface version the minor version the implementation version.</td></tr>
<tr valign="top" class="even"><td>service</td><td></td><td>The <i>service</i> tag can contain an arbitrary number of <i>interface</i> tags and one description tag.</td></tr>
<tr valign="top" class="odd"><td>&quot;</td><td>filepath</td><td>The absolute path and name of the plug-in to be loaded when this service is requested. Alternatively if the plug-in name only is provided the standard library paths (see QCoreApplication::libraryPaths()) are used to find the plug-in. Note that if the plugin name is given only, platform specific parts such as the suffix &quot;.dll&quot; and &quot;.so&quot; or plugin prefix &quot;lib&quot; should be removed to enable cross platform resolution. QLibrary is used to determine the platform specific parts of the plugin.</td></tr>
<tr valign="top" class="even"><td>&quot;</td><td>name</td><td>The name of the service.</td></tr>
</table></p>
<p>An example for a valid XML service description could be the following <i>TestService</i>:</p>
<pre>        &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
        &lt;service name=&quot;TestService&quot;  filepath=&quot;testserviceplugin&quot; &gt;
          &lt;description&gt;Test service description&lt;/description&gt;
          &lt;interface name=&quot;com.nokia.qt.ILocation&quot; version=&quot;1.4&quot; capabilities=&quot;&quot;&gt;
            &lt;description&gt;Interface that provides location support&lt;/description&gt;
          &lt;/interface&gt;
          &lt;interface name=&quot;com.nokia.qt.ILocation&quot; version=&quot;1.5&quot; capabilities=&quot;&quot;&gt;
            &lt;description&gt;Interface that provides location support&lt;/description&gt;
          &lt;/interface&gt;
          &lt;interface name=&quot;com.nokia.qt.ISysInfo&quot; capabilities=&quot;ReadUserData&quot; version=&quot;2.3&quot;&gt;
            &lt;description&gt;Interface that provides system information support&lt;/description&gt;
          &lt;/interface&gt;
        &lt;/service&gt;</pre>
<a name="installing-the-service-at-runtime"></a>
<h3>Installing the service at runtime</h3>
<p>New services can be added and removed at any time via <a href="qservicemanager.html#addService">QServiceManager::addService</a>() and <a href="qservicemanager.html#removeService">QServiceManager::removeService</a>().</p>
<a name="identifying-services"></a>
<h2>Identifying services</h2>
<p>Each implementation is identified by a service name, an interface name and its version. This information is encapsulated by <a href="qserviceinterfacedescriptor.html">QServiceInterfaceDescriptor</a> which can be used to request references to service objects.</p>
<p><a href="qservicefilter.html">QServiceFilter</a> simplifies the lookup of already installed services. Developers specifies the criteria used during the meta data lookup. The subsequent example demonstrates the interaction between <a href="qserviceinterfacedescriptor.html">QServiceInterfaceDescriptor</a> and <a href="qservicefilter.html">QServiceFilter</a> by creating references to all services that implement the above <i>com.nokia.qt.TestService</i> interface:</p>
<pre>        QServiceManager mgr;
        QServiceFilter filter;
        filter.setInterfaceName(&quot;com.nokia.qt.TestService&quot;);
        QList&lt;QServiceInterfaceDescriptor&gt; list = mgr.findInterfaces(filter);
        for( int i = 0; i&lt;list.size(); i++) {
            QObject* obj = mgr.loadInterface(list[i]);
            if (obj) obj.setParent(this); <span class="comment">//returned object owned by client</span>
        }</pre>
<a name="building-and-compiling"></a>
<h2>Building and compiling</h2>
<p>This library requires Qt 4.5 to be installed.</p>
<p>To build the library, run <tt>qmake</tt> and <tt>make</tt>.</p>
<a name="reference-documentation"></a>
<h2>Reference documentation</h2>
<a name="main-classes"></a>
<h3>Main classes</h3>
<ul>
<li><a href="qservicecontext.html">QServiceContext</a></li>
<li><a href="qservicefilter.html">QServiceFilter</a></li>
<li><a href="qserviceinterfacedescriptor.html">QServiceInterfaceDescriptor</a></li>
<li><a href="qservicemanager.html">QServiceManager</a></li>
<li><a href="qserviceplugininterface.html">QServicePluginInterface</a></li>
<li><a href="qabstractsecuritysession.html">QAbstractSecuritySession</a></li>
</ul>
<a name="examples"></a>
<h3>Examples</h3>
<ul>
<li><a href="filemanagerplugin.html">File Manager Plugin Example</a></li>
<li><a href="bluetoothtransferplugin.html">Bluetooth Transfer Plugin Example</a></li>
<li><a href="servicebrowser.html">Service Browser Example</a></li>
</ul>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2009 QtSoftware</td>
<td align="right"><div align="right">Qt Service Framework</div></td>
</tr></table></div></address></body>
</html>
