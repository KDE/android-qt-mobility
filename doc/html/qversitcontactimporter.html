<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- qversitcontactimporter.cpp -->
  <title>Qt 1.1: QVersitContactImporter Class Reference</title>
  <link rel="stylesheet" type="text/css" href="style/style.css"
 />  <!--[if IE]>
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" href="style/style_ie8.css">
<![endif]-->
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
 <script src="./scripts/superfish.js" type="text/javascript"></script>
 <script src="./scripts/narrow.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style/superfish.css" />  <link rel="stylesheet" type="text/css" href="style/narrow.css" /></head>
<body class="" onload="CheckEmptyAndLoadList();">
 <div class="header" id="qtdocheader">
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Mobility Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://qt.nokia.com/developer">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
        <li class="nav-topright-shop"><a title="SHOP" href="http://shop.qt.nokia.com">SHOP</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Mobility 1.1</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt.nokia.com/doc/">ALL Qt VERSIONS        </a></li>
      </ul>
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global stuff</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="declarativeui.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html#Demos">QML Demos</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="modules.html">Modules</a></li>              <li>QVersitContactImporter</li>
            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<div class="toc">
<h3>Contents</h3>
<ul>
<li class="level1"><a href="#public-types">Public Types</a></li>
<li class="level1"><a href="#public-functions">Public Functions</a></li>
<li class="level1"><a href="#details">Detailed Description</a></li>
<li class="level2"><a href="#importing-categories">Importing categories</a></li>
</ul>
</div>
<h1 class="title">QVersitContactImporter Class Reference</h1>
<p>The QVersitContactImporter class converts <a href="qversitdocument.html">QVersitDocuments</a> to <a href="qcontact.html">QContacts</a>. <a href="#details">More...</a></p>
<pre class="highlightedCode brush: cpp"> #include &lt;QVersitContactImporter&gt;</pre><ul>
<li><a href="qversitcontactimporter-members.html">List of all members, including inherited members</a></li>
</ul>
<hr />
<a name="public-types"></a>
<h2>Public Types</h2>
<table class="alignedsummary">
<tr><td class="memItemLeft rightAlign topAlign"> enum </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#Error-enum">Error</a></b> { NoError, InvalidDocumentError, EmptyDocumentError }</td></tr>
</table>
<hr />
<a name="public-functions"></a>
<h2>Public Functions</h2>
<table class="alignedsummary">
<tr><td class="memItemLeft rightAlign topAlign"> </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#QVersitContactImporter">QVersitContactImporter</a></b> ()</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#dtor.QVersitContactImporter">~QVersitContactImporter</a></b> ()</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> QList&lt;QContact&gt; </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#contacts">contacts</a></b> () const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> QMap&lt;int, Error&gt; </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#errors">errors</a></b> () const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> bool </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#importDocuments">importDocuments</a></b> ( const QList&lt;QVersitDocument&gt; &amp; <i>documents</i> )</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> QVersitResourceHandler * </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#resourceHandler">resourceHandler</a></b> () const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#setPropertyHandler">setPropertyHandler</a></b> ( QVersitContactImporterPropertyHandlerV2 * <i>handler</i> )</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="qversitcontactimporter.html#setResourceHandler">setResourceHandler</a></b> ( QVersitResourceHandler * <i>handler</i> )</td></tr>
</table>
<a name="details"></a>
<hr />
<div class="descr"/>
<h2>Detailed Description</h2>
<p>The QVersitContactImporter class converts <a href="qversitdocument.html">QVersitDocuments</a> to <a href="qcontact.html">QContacts</a>.</p>
<p>This class is used to convert lists of <a href="qversitdocument.html">QVersitDocuments</a> (which may be produced by a <a href="qversitreader.html">QVersitReader</a>) to lists of <a href="qcontact.html">QContacts</a> (which may be saved into a <a href="qcontactmanager.html">QContactManager</a>. Unless there is an error, there is a one-to-one mapping between Versit documents and QContacts. The importer can be extended by clients by associating resource and property handlers.</p>
<p>A <a href="qversitresourcehandler.html">QVersitResourceHandler</a> is associated with the importer to supply the behaviour for saving files to persistent storage. By default, this is set to a <a href="qversitdefaultresourcehandler.html">QVersitDefaultResourceHandler</a>, which does not save files to persistent storage. Note that although photos found in vCards are not saved to disk by default, the importer does add a QContactThumbnail detail to the image. If a full-sized image needs to be loaded from a URL and persisted on disk, a custom <a href="qversitresourcehandler.html">QVersitResourceHandler</a> should be supplied which implements this.</p>
<p>By associating a <a href="qversitcontactimporterpropertyhandlerv2.html">QVersitContactImporterPropertyHandlerV2</a> with the importer using <a href="qversitcontactimporter.html#setPropertyHandler">setPropertyHandler</a>(), the client can pass in a handler to override the processing of properties and/or handle properties that QVersitContactImporter doesn't support. A &quot;backup&quot; handler is provided by <a href="qversitcontactimporterpropertyhandlerv2.html#createBackupHandler">QVersitContactImporterPropertyHandlerV2::createBackupHandler</a>() which imports properties generated by the corresponding backup handler for the <a href="qversitcontactexporter.html">QVersitContactExporter</a>.</p>
<p>An example usage of QVersitContactImporter:</p>
<pre class="highlightedCode brush: cpp">     QVersitContactImporter importer;

     QVersitContactImporterPropertyHandlerV2* backupHandler =
         QVersitContactImporterPropertyHandlerV2::createBackupHandler();
     importer.setPropertyHandler(backupHandler);

     QVersitDocument document;

     QVersitProperty property;
     property.setName(QString::fromAscii(&quot;N&quot;));
     property.setValue(&quot;Citizen;John;Q;;&quot;);
     document.addProperty(property);

     property.setName(QString::fromAscii(&quot;X-UNKNOWN-PROPERTY&quot;));
     property.setValue(&quot;some value&quot;);
     document.addProperty(property);

     if (importer.importDocuments(QList&lt;QVersitDocument&gt;() &lt;&lt; document)) {
         QList&lt;QContact&gt; contactList = importer.contacts();
         <span class="comment">// contactList.first() now contains the &quot;N&quot; property as a QContactName</span>
         <span class="comment">// propertyHandler.mUnknownProperties contains the list of unknown properties</span>
     }

     delete backupHandler;</pre>
<a name="importing-categories"></a>
<h3>Importing categories</h3>
<p>The importer imports the vCard CATEGORIES property by converting each category to a QContactTag. Some managers may not have support for QContactTag, but instead support categorization using the <a href="qcontactrelationship.html#HasMember-var">HasMember</a> <a href="qcontactrelationship.html">QContactRelationship</a> along with contacts of type TypeGroup. For these backends, if the categorization information needs to be retained through group relationships, extra work needs to be done to do the conversion. Below is some example code that does this translation.</p>
<pre class="highlightedCode brush: cpp"><span class="comment"> /*! Adds contacts in  \a newContacts into \a manager, converting categories specified
   with tags into group membership relationships.  Note that this implementation uses the
   synchronous API of QContactManager for clarity.  It is recommended that the asynchronous
   API is used in practice.

   Relationships are added so that if a contact, A, has a tag &quot;b&quot;, then a HasMember relationship is
   created between a group contact in the manager, B with display label &quot;b&quot;, and contact A.  If there
   does not exist a group contact with display label &quot;b&quot;, one is created.
   */</span>
 void insertWithGroups(const QList&lt;QContact&gt;&amp; newContacts, QContactManager* manager)
 {
     <span class="comment">// Cache map from group names to QContactIds</span>
     QMap&lt;QString, QContactId&gt; groupMap;

     foreach (QContact contact, newContacts) {
         if (!manager-&gt;saveContact(&amp;contact))
             continue; <span class="comment">// In practice, better error handling may be required</span>
         foreach (const QContactTag&amp; tag, contact.details&lt;QContactTag&gt;()) {
             QString groupName = tag.tag();
             QContactId groupId;
             if (groupMap.contains(groupName)) {
                 <span class="comment">// We've already seen a group with the right name</span>
                 groupId = groupMap.value(groupName);
             } else {
                 QContactDetailFilter groupFilter;
                 groupFilter.setDetailDefinitionName(QContactType::DefinitionName);
                 groupFilter.setValue(QLatin1String(QContactType::TypeGroup));
                 groupFilter.setMatchFlags(QContactFilter::MatchExactly);
                 <span class="comment">// In practice, some detail other than the display label could be used</span>
                 QContactDetailFilter nameFilter = QContactDisplayLabel::match(groupName);
                 QList&lt;QContactLocalId&gt; matchingGroups = manager-&gt;contactIds(groupFilter &amp; nameFilter);
                 if (!matchingGroups.isEmpty()) {
                     <span class="comment">// Found an existing group in the manager</span>
                     QContactId groupId;
                     groupId.setManagerUri(manager-&gt;managerUri());
                     groupId.setLocalId(matchingGroups.first());
                     groupMap.insert(groupName, groupId);
                 }
                 else {
                     <span class="comment">// Make a new group</span>
                     QContact groupContact;
                     QContactName name;
                     name.setCustomLabel(groupName);
                     <span class="comment">// Beware that not all managers support custom label</span>
                     groupContact.saveDetail(&amp;name);
                     if (!manager-&gt;saveContact(&amp;groupContact))
                         continue; <span class="comment">// In practice, better error handling may be required</span>
                     groupId = groupContact.id();
                     groupMap.insert(groupName, groupId);
                 }
             }
             <span class="comment">// Add the relationship</span>
             QContactRelationship rel;
             rel.setFirst(groupId);
             rel.setRelationshipType(QContactRelationship::HasMember);
             rel.setSecond(contact.id());
             manager-&gt;saveRelationship(&amp;rel);
         }
     }
 }</pre>
</div>
<p>See also <a href="qversitdocument.html">QVersitDocument</a>, <a href="qversitproperty.html">QVersitProperty</a>, <a href="qversitresourcehandler.html">QVersitResourceHandler</a>, and <a href="qversitcontactimporterpropertyhandlerv2.html">QVersitContactImporterPropertyHandlerV2</a>.</p>
<hr />
<div class="types"/>
<h2>Member Type Documentation</h2>
<h3 class="fn"><a name="Error-enum"></a>enum QVersitContactImporter::Error</h3>
<p>This enum specifies an error that occurred during the most recent call to <a href="qversitcontactimporter.html#importDocuments">importDocuments</a>()</p>
<table class="valuelist"><tr class="odd"><tr><th>Constant</th><th>Value</th><th>Description</th></tr>
<tr><td  class="topAlign"><tt>QVersitContactImporter::NoError</tt></td><td class=" topAlign"><tt>0</tt></td><td  class="topAlign">The most recent operation was successful</td></tr>
<tr><td  class="topAlign"><tt>QVersitContactImporter::InvalidDocumentError</tt></td><td class=" topAlign"><tt>1</tt></td><td  class="topAlign">One of the documents is not a vCard</td></tr>
<tr><td  class="topAlign"><tt>QVersitContactImporter::EmptyDocumentError</tt></td><td class=" topAlign"><tt>2</tt></td><td  class="topAlign">One of the documents is empty</td></tr>
</table>
</div>
<hr />
<div class="func"/>
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QVersitContactImporter"></a>QVersitContactImporter::QVersitContactImporter ()</h3>
<p>Constructs a new importer</p>
<h3 class="fn"><a name="dtor.QVersitContactImporter"></a>QVersitContactImporter::~QVersitContactImporter ()</h3>
<p>Frees the memory used by the importer</p>
<h3 class="fn"><a name="contacts"></a>QList&lt;<a href="qcontact.html">QContact</a>&gt; QVersitContactImporter::contacts () const</h3>
<p>Returns the contacts imported in the most recent call to <a href="qversitcontactimporter.html#importDocuments">importDocuments</a>().</p>
<p>See also <a href="qversitcontactimporter.html#importDocuments">importDocuments</a>().</p>
<h3 class="fn"><a name="errors"></a>QMap&lt;int, <a href="qversitcontactimporter.html#Error-enum">Error</a>&gt; QVersitContactImporter::errors () const</h3>
<p>Returns the map of errors encountered in the most recent call to <a href="qversitcontactimporter.html#importDocuments">importDocuments</a>(). The key is the index into the input list of documents and the value is the error that occurred on that document.</p>
<p>See also <a href="qversitcontactimporter.html#importDocuments">importDocuments</a>().</p>
<h3 class="fn"><a name="importDocuments"></a>bool QVersitContactImporter::importDocuments ( const QList&lt;<a href="qversitdocument.html">QVersitDocument</a>&gt; &amp; <i>documents</i> )</h3>
<p>Converts <i>documents</i> into a corresponding list of QContacts. After calling this, the converted contacts can be retrieved by calling <a href="qversitcontactimporter.html#contacts">contacts</a>(). Returns true on success. If any of the documents cannot be imported as contacts (eg. they aren't vCards), false is returned and <a href="qversitcontactimporter.html#errors">errors</a>() will return a list describing the errors that occurred. The successfully imported documents will still be available via <a href="qversitcontactimporter.html#contacts">contacts</a>().</p>
<p>See also <a href="qversitcontactimporter.html#contacts">contacts</a>() and <a href="qversitcontactimporter.html#errors">errors</a>().</p>
<h3 class="fn"><a name="resourceHandler"></a><a href="qversitresourcehandler.html">QVersitResourceHandler</a> * QVersitContactImporter::resourceHandler () const</h3>
<p>Returns the associated resource handler.</p>
<p>See also <a href="qversitcontactimporter.html#setResourceHandler">setResourceHandler</a>().</p>
<h3 class="fn"><a name="setPropertyHandler"></a>void QVersitContactImporter::setPropertyHandler ( <a href="qversitcontactimporterpropertyhandlerv2.html">QVersitContactImporterPropertyHandlerV2</a> * <i>handler</i> )</h3>
<p>Sets <i>handler</i> to be the handler for processing QVersitProperties, or 0 to have no handler.</p>
<p>Does not take ownership of the handler. The client should ensure the handler remains valid for the lifetime of the exporter. This function is used for version 2 and higher handlers.</p>
<p>Only one property handler can be set. If another property handler (of any version) was previously set, it will no longer be associated with the importer.</p>
<h3 class="fn"><a name="setResourceHandler"></a>void QVersitContactImporter::setResourceHandler ( <a href="qversitresourcehandler.html">QVersitResourceHandler</a> * <i>handler</i> )</h3>
<p>Sets <i>handler</i> to be the handler to save files with, or 0 to have no handler.</p>
<p>Does not take ownership of the handler. The client should ensure the handler remains valid for the lifetime of the exporter.</p>
<p>See also <a href="qversitcontactimporter.html#resourceHandler">resourceHandler</a>().</p>
</div>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2009-2010 Nokia Corporation and/or its subsidiary(-ies)</td>
<td width="20%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qt Mobility Project 1.1.0</div></td>
</tr></table></div></address>  <script src="scripts/functions.js" type="text/javascript"></script>
</body>
</html>
