<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- servicebrowser.qdoc -->
  <title>Qt 1.1: Service Browser Example</title>
  <link rel="stylesheet" type="text/css" href="style/style.css"
 />  <!--[if IE]>
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" href="style/style_ie8.css">
<![endif]-->
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
 <script src="./scripts/superfish.js" type="text/javascript"></script>
 <script src="./scripts/narrow.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style/superfish.css" />  <link rel="stylesheet" type="text/css" href="style/narrow.css" /></head>
<body class="" onload="CheckEmptyAndLoadList();">
 <div class="header" id="qtdocheader">
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Mobility Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://qt.nokia.com/developer">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
        <li class="nav-topright-shop"><a title="SHOP" href="http://shop.qt.nokia.com">SHOP</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Mobility 1.1</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt.nokia.com/doc/">ALL Qt VERSIONS        </a></li>
      </ul>
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global stuff</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="declarativeui.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html#Demos">QML Demos</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li><a href="examples-servicebrowser.html"></a></li>              <li>Service Browser Example</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#servicebrowser-class-definition">ServiceBrowser Class Definition</a></li>
<li class="level1"><a href="#servicebrowser-class-implementation">ServiceBrowser Class Implementation</a></li>
<li class="level2"><a href="#invoking-attributes-an-example">Invoking attributes: an example</a></li>
</ul>
</div>
<h1 class="title">Service Browser Example</h1>
<span class="subtitle"></span>
<div class="descr"/>
<p>Files:</p>
<ul>
<li><a href="servicebrowser-servicebrowser-cpp.html">servicebrowser/servicebrowser.cpp</a></li>
<li><a href="servicebrowser-servicebrowser-h.html">servicebrowser/servicebrowser.h</a></li>
<li><a href="servicebrowser-main-cpp.html">servicebrowser/main.cpp</a></li>
<li><a href="servicebrowser-servicebrowser-pro.html">servicebrowser/servicebrowser.pro</a></li>
</ul>
<p>This example shows how to use the Service Framework to:</p>
<ul>
<li>Register and unregister services</li>
<li>Find available services</li>
<li>Find the interfaces that are implemented by a service</li>
<li>Look up the attributes for an interface implementation using the meta-object system</li>
<li>Set a default interface implementation</li>
</ul>
<p class="centerAlign"><img src="images/servicebrowser.png" alt="Screenshot of the Service Browser example" /></p><p>The application window is split into three panes.</p>
<p>The top-left pane shows all the services that are registered within the Service Framework. For this example, the <a href="filemanagerplugin.html">filemanagerplugin</a> and <a href="bluetoothtransferplugin.html">bluetoothtransferplugin</a> services included in the <tt>examples/</tt> directory have been registered, and so are visible in this pane.</p>
<p>The bottom-left pane shows the interfaces implemented by the service selected in the top-left pane. Each entry in this list shows:</p>
<ul>
<li>The name and version of the implemented interface</li>
<li>The service that provides this implementation (in brackets)</li>
<li>Whether the implementation is the default for its interface</li>
</ul>
<p>The right-hand pane shows the attributes of an interface implementation that are invokable through the Qt meta-object system. Such attributes include signals, slots, properties and methods marked with the <tt>Q_INVOKABLE</tt> macro. If the &quot;Selected implementation&quot; radio button is checked, this view shows the attributes of the selected implementation in the bottom-left pane; otherwise, it shows the attributes of the <i>default</i> implementation for the interface of the selected implementation.</p>
<a name="servicebrowser-class-definition"></a><div class="navTop"><a href="#toc"><img src="./images/bullet_up.png"></a></div>
<h2>ServiceBrowser Class Definition</h2>
<p>The ServiceBrowser class inherits from QWidget. It has several slots for reloading the lists in the three information panes, and for changing the default implementation for an interface.</p>
<pre class="highlightedCode brush: cpp"> class ServiceBrowser : public QWidget
 {
     Q_OBJECT
 public:
     ServiceBrowser(QWidget *parent = 0, Qt::WindowFlags flags = 0);
     ~ServiceBrowser();

 private slots:
     void currentInterfaceImplChanged(QListWidgetItem *current, QListWidgetItem *previous);
     void reloadServicesList();
     void reloadInterfaceImplementationsList();
     void reloadAttributesList();
     void setDefaultInterfaceImplementation();

 private:
     ...
 };</pre>
<a name="servicebrowser-class-implementation"></a><div class="navTop"><a href="#toc"><img src="./images/bullet_up.png"></a></div>
<h2>ServiceBrowser Class Implementation</h2>
<pre class="highlightedCode brush: cpp"> ServiceBrowser::ServiceBrowser(QWidget *parent, Qt::WindowFlags flags)
     : QWidget(parent, flags)
 {
     serviceManager = new QServiceManager(this);

     registerExampleServices();

     initWidgets();
     reloadServicesList();

     setWindowTitle(tr(&quot;Services Browser&quot;));
 }</pre>
<p>The constructor registers the &quot;FileManagerService&quot; and &quot;BluetoothTransferService&quot; services that are provided by the <a href="filemanagerplugin.html">filemanagerplugin</a> and <a href="bluetoothtransferplugin.html">bluetoothtransferplugin</a> projects in the <tt>examples/</tt> directory. It also calls <tt>reloadServicesList()</tt> to show these two newly registered services in the top-left pane.</p>
<pre class="highlightedCode brush: cpp"> void ServiceBrowser::reloadServicesList()
 {
     servicesListWidget-&gt;clear();

     QStringList services = serviceManager-&gt;findServices();
     for (int i=0; i&lt;services.count(); i++)
         servicesListWidget-&gt;addItem(services[i]);

     servicesListWidget-&gt;addItem(showAllServicesItem);
 }</pre>
<p>When the services list in the top-left pane needs to be refreshed, we call <a href="qservicemanager.html#findServices">QServiceManager::findServices</a>() to get a QStringList of all services that are currently registered with the service framework.</p>
<pre class="highlightedCode brush: cpp"> void ServiceBrowser::reloadInterfaceImplementationsList()
 {
     ...
     ...
     QList&lt;QServiceInterfaceDescriptor&gt; descriptors = serviceManager-&gt;findInterfaces(serviceName);

     attributesListWidget-&gt;clear();
     interfacesListWidget-&gt;clear();
     for (int i=0; i&lt;descriptors.count(); i++) {
         QString text = QString(&quot;%1 %2.%3&quot;)
                 .arg(descriptors[i].interfaceName())
                 .arg(descriptors[i].majorVersion())
                 .arg(descriptors[i].minorVersion());

         if (serviceName.isEmpty())
             text += &quot; (&quot; + descriptors[i].serviceName() + &quot;)&quot;;

         QServiceInterfaceDescriptor defaultInterfaceImpl =
                 serviceManager-&gt;interfaceDefault(descriptors[i].interfaceName());
         if (descriptors[i] == defaultInterfaceImpl)
             text += tr(&quot; (default)&quot;);

         QListWidgetItem *item = new QListWidgetItem(text);
         item-&gt;setData(Qt::UserRole, qVariantFromValue(descriptors[i]));
         interfacesListWidget-&gt;addItem(item);
     }

     ...
 }</pre>
<p>To create the list of interface implementations in the bottom-left pane, we call <a href="qservicemanager.html#findInterfaces">QServiceManager::findInterfaces</a>() to get a list of <a href="qserviceinterfacedescriptor.html">QServiceInterfaceDescriptor</a> objects. If a particular service has been selected in the top-left pane, we call <a href="qservicemanager.html#findInterfaces">QServiceManager::findInterfaces</a>() with the name of that service as the argument, so that it will only return the interface implementations provided by that service. Otherwise, it is called with no argument to retrieve a list of all implementations provided by all registered services.</p>
<p>The example maps each entry in the interface implementations list to its corresponding <a href="qserviceinterfacedescriptor.html">QServiceInterfaceDescriptor</a> object using the QListWidgetItem::setData() method.</p>
<p>Note how we also call QServiceManager::defaultServiceInterface() to determine whether an interface implementation is the default for that interface.</p>
<pre class="highlightedCode brush: cpp"> void ServiceBrowser::reloadAttributesList()
 {
     QListWidgetItem *item = interfacesListWidget-&gt;currentItem();
     if (!item)
         return;

     QServiceInterfaceDescriptor selectedImpl =
             item-&gt;data(Qt::UserRole).value&lt;QServiceInterfaceDescriptor&gt;();

     QObject *implementationRef;
     if (selectedImplRadioButton-&gt;isChecked())
         implementationRef = serviceManager-&gt;loadInterface(selectedImpl, 0, 0);
     else
         implementationRef = serviceManager-&gt;loadInterface(selectedImpl.interfaceName(), 0, 0);

     ...</pre>
<p>The <tt>reloadAttributesList()</tt> method creates the list in the right-hand pane that shows the attributes of an interface implementation that can be invoked through the Qt meta-object system.</p>
<p><a href="qservicemanager.html#loadInterface">QServiceManager::loadInterface</a>() is called to get an instance of the identified interface implementation. This method finds the corresponding service plugin and returns the QObject instance provided by the service plugin's <a href="qserviceplugininterface.html#createInstance">QServicePluginInterface::createInstance</a>() method.</p>
<pre class="highlightedCode brush: cpp">     ...
     const QMetaObject *metaObject = implementationRef-&gt;metaObject();
     attributesGroup-&gt;setTitle(tr(&quot;Invokable attributes for %1 class&quot;)
             .arg(QString(metaObject-&gt;className())));
     for (int i=0; i&lt;metaObject-&gt;methodCount(); i++) {
         QMetaMethod method = metaObject-&gt;method(i);
         attributesListWidget-&gt;addItem(&quot;[METHOD] &quot; + QString(method.signature()));
     }
     for (int i=0; i&lt;metaObject-&gt;propertyCount(); i++) {
         QMetaProperty property = metaObject-&gt;property(i);
         attributesListWidget-&gt;addItem(&quot;[PROPERTY] &quot; + QString(property.name()));
     }
 }</pre>
<p>Call QObject::metaObject() on the implementation instance to get a QMetaObject instance that reveals the dynamically invokable attributes for the instance. These attributes include properties, signals, slots, and methods marked with the Q_INVOKABLE macro. Call QMetaObject::method() to get information about a signal, slot or invokable method, and QMetaObject::property() to access a property of the instance.</p>
<p>When you know the name of the method you wish to invoke, call QMetaObject::invoke() or QMetaMethod::invoke() to invoke it dynamically. Similarly, QMetaProperty::read() and QMetaProperty::write() can be used to read and modify the value of a property.</p>
<a name="invoking-attributes-an-example"></a><div class="navTop"><a href="#toc"><img src="./images/bullet_up.png"></a></div>
<h3>Invoking attributes: an example</h3>
<p>Here is an example of invoking attributes on an implementation, using the <a href="filemanagerplugin.html">FileManagerPlugin</a> that is shown in the Service Browser.</p>
<p>The <a href="filemanagerplugin.html">FileManagerPlugin</a> provides a service called &quot;FileManagerService&quot; in its <tt>filemanagerplugin.xml</tt> service definition. When FileManagerPlugin::createInstance() is called, if the com.nokia.qt.examples.FileStorage interface is requested, it returns an instance of the FileManagerStorage class. The FileManagerStorage class is defined like this:</p>
<pre class="highlightedCode brush: cpp"> class FileManagerStorage : public QObject
 {
     Q_OBJECT
     Q_PROPERTY(QString workingDirectory READ workingDirectory WRITE setWorkingDirectory)

 public:
     FileManagerStorage(QObject *parent = 0);

     void setWorkingDirectory(const QString &amp;path);
     QString workingDirectory() const;

 signals:
     void workingDirectoryChanged(const QString &amp;newDir);

 public slots:
     void copyFile(const QString &amp;currentPath, const QString &amp;newPath);

 private:
     QString directory;
 };</pre>
<p>So if, in the ServiceBrowser application, we select the com.nokia.qt.examples.FileStorage implementation provided by FileManagerService, the browser would display all the dynamically invokable attributes of the FileManagerStorage class:</p>
<p class="centerAlign"><img src="images/servicebrowser-attributes.png" /></p><p>As you can see, the FileManagerStorage::workingDirectory property, the FileManagerStorage::copyFile() slot and the FileManagerStorage::workingDirectoryChanged() signal are all listed. (The destroyed(), deleteLater() and _q_reregisterTimers() attributes are inherited from the QObject parent.)</p>
<p>To invoke the <tt>copyFile()</tt> slot, for example:</p>
<pre class="highlightedCode brush: cpp"> QObject *interfaceImpl = QServiceManager::loadInterface(&quot;com.nokia.qt.examples.FileStorage&quot;, 0, 0);
 QMetaObject::invokeMethod(interfaceImpl, &quot;copyFile&quot;,
                           Q_ARG(QString, &quot;path/to/file.txt&quot;),
                           Q_ARG(QString, &quot;new/path/to/file.txt&quot;));</pre>
<p>Of course, the <a href="qservicemanager.html#loadInterface">QServiceManager::loadInterface</a>() call here assumes the FileManagerStorage implementation is the default for the com.nokia.qt.examples.FileStorage interface. Otherwise, it would have to pass a <a href="qserviceinterfacedescriptor.html">QServiceInterfaceDescriptor</a> object to <a href="qservicemanager.html#loadInterface">QServiceManager::loadInterface</a>() instead of just the interface name to ensure the correct implementation is loaded.</p>
</div>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2009-2010 Nokia Corporation and/or its subsidiary(-ies)</td>
<td width="20%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qt Mobility Project 1.1.0</div></td>
</tr></table></div></address>  <script src="scripts/functions.js" type="text/javascript"></script>
  <!-- <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4457116-5']);
  _gaq.push(['_trackPageview']);
  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script> -->
</body>
</html>
